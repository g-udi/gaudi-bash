#!/usr/bin/env bash
# shellcheck shell=bash

declare GAUDI_TEST_DIRECTORY GAUDI_BASH_DIR GAUDI_BATS GAUDI_BASH_GIT_DIR GAUDI_TEST_DEPS_DIR

# Locate ourselves for easy reference.
GAUDI_TEST_DIRECTORY="$(cd "$(dirname "$0")" && pwd)"
GAUDI_BASH_DIR="${GAUDI_TEST_DIRECTORY%/*}"
GAUDI_BATS="${GAUDI_TEST_DIRECTORY}/../bin/bats-core/bin/bats"
GAUDI_BASH_GIT_DIR="${GAUDI_BASH_DIR}/.git"
GAUDI_TEST_DEPS_DIR="${GAUDI_BASH_DIR:-${BATS_TEST_DIRNAME?}/../..}/bin"

git submodule init && git submodule update

if [[ -z "${GAUDI_BASH_ORIGIN}" ]]; then
	declare GAUDI_BASH_ORIGIN
	GAUDI_BASH_ORIGIN=$(cd "${GAUDI_TEST_DIRECTORY%/*}" && pwd)
	export GAUDI_BASH_ORIGIN
fi


export GAUDI_TEST_DIRECTORY GAUDI_BASH_DIR GAUDI_BATS GAUDI_BASH_GIT_DIR GAUDI_TEST_DEPS_DIR

echo -e "
\033c
 ██████╗  █████╗ ██╗   ██╗██████╗ ██╗      ██████╗  █████╗ ███████╗██╗  ██╗
██╔════╝ ██╔══██╗██║   ██║██╔══██╗██║      ██╔══██╗██╔══██╗██╔════╝██║  ██║
██║  ███╗███████║██║   ██║██║  ██║██║█████╗██████╔╝███████║███████╗███████║
██║   ██║██╔══██║██║   ██║██║  ██║██║╚════╝██╔══██╗██╔══██║╚════██║██╔══██║
╚██████╔╝██║  ██║╚██████╔╝██████╔╝██║      ██████╔╝██║  ██║███████║██║  ██║
 ╚═════╝ ╚═╝  ╚═╝ ╚═════╝ ╚═════╝ ╚═╝      ╚═════╝ ╚═╝  ╚═╝╚══════╝╚═╝  ╚═╝


Running gaudi-bash unit tests.. \n\n"

bash "$GAUDI_TEST_DIRECTORY"/runners/run-bats.bash
# bash "$GAUDI_TEST_DIRECTORY"/runners/run-search.bash